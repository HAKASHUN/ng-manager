"use strict";angular.module("ngManager",["ngRoute","ngAnimate","ngAria","ngMaterial","pascalprecht.translate","angular-loading-bar"]).config(["$routeProvider",function(e){console.info("Configuring routings"),e.when("/endpoints",{controller:"EndpointCtrl",templateUrl:"endpoint.html"}).when("/top",{controller:"TopCtrl",templateUrl:"top.html"}).when("/entity/:kind",{controller:"EntityCtrl",templateUrl:"entity/index.html"})}]).run(["$endpointService","$apiService","$errorService","$location",function(e,n,t,r){console.info("Started running ng-manager");var o=e.getSelected();o?n.setup().then(function(){},function(e){t.showError(e)}):r.url("/endpoints")}]),angular.module("ngManager").factory("$apiService",["$q","$endpointService","$http","$rootScope",function(e,n,t,r){var o=null,a=function(e){var t=n.getSelected(),r=t.url.replace(/(.*)\/+$/,"$1");return e=e.replace(/^\/+(.*)$/,"$1"),r+"/"+e},i=function(e,n){return t({url:a(e),method:"GET",params:n}).then(function(e){return e.data},function(e,n){var t=e&&e.message||"Server error",r=new Error(t);return r.status=n,r})},l=function(){var n=e.defer();return null!==o?n.resolve(o):(console.info("Getting config"),i("/config").then(n.resolve.bind(n),n.reject.bind(n))),n.promise};return{setup:function(){return console.log("apiService.setup"),o=null,l().then(function(e){return o=e,r.$emit("config",o),o},function(e){return e})},config:function(){return o},get:i}}]).factory("progressHttpInterceptor",["$rootScope","$q",function(e,n){var t=0,r=function(){0===t++&&e.$emit("progress.start")},o=function(){0===--t&&(t=0,e.$emit("progress.end"))};return{request:function(e){return r(),e||n.when(e)},requestError:function(e){return o(),n.reject(e)},response:function(e){return o(),e||n.when(e)},responseError:function(e){return o(),n.reject(e)}}}]).config(["$httpProvider",function(e){e.interceptors.push("progressHttpInterceptor")}]),angular.module("ngManager").controller("EndpointCtrl",["$q","$scope","$rootScope","$schemaForm","$endpointService","$apiService","$errorService",function(e,n,t,r,o,a,i){n.endpoints=o.getAll(),n.remove=function(e){o.remove(e)},n.select=function(e){o.select(e),a.setup().then(function(){location.hash="top"},function(e){i.showError(e)})};var l=function(e){o.add(e)};t.$emit("content.title",{section:"Endpoints"}),n.showForm=function(n){r.showDialog({title:"Add the endpoint",event:n,schema:{type:"object",properties:{name:{type:"string"},url:{type:"string",format:"uri",style:"long"}},required:["name","url"]},submit:function(n){var t=e.defer(),r=n.entity;return l(r),t.resolve(),t.promise}})}}]),angular.module("ngManager").factory("$endpointService",function(){var e=[],n=localStorage.getItem("endpoints");return n&&(e=JSON.parse(n)),{getAll:function(){return e},getSelected:function(){return _.find(e,function(e){return e.selected===!0})},get:function(n){return e[n]},add:function(n){e.push(n),this.save()},remove:function(n){e.splice(n,1),this.save()},select:function(n){_.each(e,function(e,t){t===n?e.selected=!0:delete e.selected}),this.save()},save:function(){var n=_.map(e,function(e){return _.pick(e,"name","url","selected")});localStorage.setItem("endpoints",JSON.stringify(n))}}}),angular.module("ngManager").controller("EntityCtrl",["$scope","$routeParams","$rootScope","$schemaForm","$entityService","$errorService","$window",function(e,n,t,r,o,a,i){var l=n.kind;console.info("Entity",l),t.$emit("content.title",{section:"Entities",page:l}),e.list=function(){o.list({kind:l}).then(function(n){e.fields=n.fields,e.rows=n.list,setTimeout(u,0)},function(e){a.showError(e)})};var u=function(){var e=document.getElementById("entity-table-body"),n=e.getBoundingClientRect(),t=Math.floor(i.innerHeight-n.top);e.style.height=t+"px"};e.$on("window.resize",u),e.list()}]),angular.module("ngManager").directive("entityTable",function(){return{restrict:"AE",link:function(){},templateUrl:"entity/table.html"}}),angular.module("ngManager").service("$entityService",["$q","$apiService",function(e,n){var t=function(e){return _.find(n.config().entities,function(n){return n.id===e})},r=function(e){var n=e.features||{},t=n.list&&n.list.fields||_.keys(e.schema.properties),r=Math.floor(100/t.length);return _.map(t,function(e){return"string"==typeof e&&(e={id:e}),e.style={width:(e.width||r)+"%"},e})};return{list:function(o){o=o||{};var a=e.defer(),i=o.kind||"";return""===i?(a.reject(new Error("Kind is empty")),a.promise):(n.get("/entity/"+i).then(function(e){var n=t(i);void 0===n?a.reject({message:"Entity configuration not found for {{kind}}",params:{kind:i}}):(e.fields=r(n),a.resolve(e))},function(e){a.reject(e)}),a.promise)},showForm:function(){var n=e.defer();return n.promise},remove:function(){var n=e.defer();return n.promise}}}]),angular.module("ngManager").factory("$errorService",["$mdToast",function(e){return{showError:function(n){var t="";t="string"==typeof n?n:n.message?n.message:n?n.toString():"Unknown Error",e.show({controller:["$scope",function(r){r.message=t,r.params=n.params||{},r.closeToast=function(){e.hide()}}],templateUrl:"/toasts/error.html",duration:6e3,position:"top right"})}}}]),angular.module("ngManager").controller("IndexCtrl",["$scope","$rootScope","$mdSidenav","$timeout","$interval","$location","$window","$translate","$translateLoader",function(e,n,t,r,o,a,i,l,u){e.toggleMenu=function(){r(function(){t("left").toggle()})},e.site={title:"NG-Manager"},e.head={},e.moveTo=function(e){a.url(e),t("left").toggle()},n.$on("content.title",function(n,t){e.head.title=t}),n.$on("progress.start",function(){e.progress={mode:"indeterminate",value:0}}),n.$on("progress.end",function(){var n=e.progress;"indeterminate"===n.mode&&(n.mode="determinate",n.value=0);var t=o(function(){n.value+=20,n.value>=100&&(o.cancel(t),r(function(){delete e.progress},400))},50)}),e.openRight=!0,n.$on("config",function(n,t){console.info("Loaded configuration",t),e.config=t,e.site=t.site,t.i18n&&(u.addTables(t.i18n),l.refresh())}),i.addEventListener("resize",function(){n.$broadcast("window.resize")})}]),angular.module("ngManager").config(["$translateLoaderProvider",function(e){console.info("i18n: en"),e.translations("en",{name:"Name",url:"URL"})}]),angular.module("ngManager").config(["$translateLoaderProvider",function(e){console.info("i18n: ja"),e.translations("ja",{Add:"追加",Cancel:"キャンセル",Close:"閉じる",Create:"作成",Endpoints:"エンドポイント",Entities:"データ",Name:"名前",Update:"更新",Modify:"編集",Remove:"削除",Search:"検索",Settings:"設定",Submit:"送信",Top:"トップ",name:"名前",url:"URL","Add the endpoint":"エンドポイント追加","Entity configuration not found for {{kind}}":"{{kind}}のデータ設定が見つかりません"})}]),angular.module("ngManager").provider("$translateLoader",function(){var e={},n=function(n,t){var r=e[t];r||(r=e[t]={}),e[t]=_.merge(n,r)};this.translations=function(e,t){n(t,e)},this.$get=["$q",function(t){var r=function(n){var r=n.key,o=t.defer();return o.resolve(e[r]||{}),o.promise};return r.addTables=function(e){_.each(e,n)},r}]}).config(["$translateProvider",function(e){e.useLoader("$translateLoader"),e.determinePreferredLanguage()}]),angular.module("ngManager").factory("$schemaForm",["$mdDialog","$schemaNormalizer","$schemaValidator","$q",function(e,n,t,r){return{showDialog:function(o){o=o||{};var a=o.schema,i=o.event,l=o.submit,u=r.defer();return a=n(a),e.show({template:"<md-dialog><schema-form /></md-dialog>",targetEvent:i,controller:["$scope",function(n){n.schema=a,n.entity={},n.title=o.title||"",n.errors={},n.validate=function(e){var r=t.validate(n.entity,n.schema,e);r?(r.forEach(function(e){n.errors[e.path]=e.message}),n.hasError=!0):(e?delete n.errors[e]:n.errors={},n.hasError=!1)},n.submit=function(){n.validate(),n.hasError||l.then(function(){e.hide(),u.resolve(n.entity)},function(e){console.error(e)})},n.cancel=function(){e.hide(),u.reject()}}]}),u}}}]).directive("schemaForm",function(){return{restrict:"AE",controller:function(){},templateUrl:"/schema-form/form.html"}}).directive("schemaInput",["$compile",function(e){var n=function(n,t){var r=n.spec||{},o=r.path,a='<label for="sf-'+o+'" ng-bind="spec.key|translate"></label><md-input id="sf-'+o+'" type="text" ng-model="entity[spec.path]" ng-change="validate(spec.path)"></md-input><span class="error" ng-bind="errors[spec.path]" />';a="<md-input-group>"+a+"</md-input-group>";var i=e(angular.element(a))(n);r.style&&i.addClass(r.style),t.append(i)};return{restrict:"AE",replace:!0,link:n}}]),angular.module("ngManager").factory("$schemaNormalizer",function(){var e=function(n,t,r){return"string"==typeof n&&(n={type:n}),n.path=t?t+"."+r:r,n.key=r,"object"===n.type&&_.each(n.properties,function(r,o){n.properties[o]=e(r,t,o)}),n};return e}),angular.module("ngManager").factory("$schemaValidator",function(){var e={"date-time":/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{1,3})?(?:Z|[+\-]\d{2}:\d{2})$/,date:/^\d{4}-\d{2}-\d{2}$/,time:/^\d{2}:\d{2}:\d{2}(?:\.\d{1,3})?$/,"utc-millisec":function(e){return!isNaN(parseInt(e,10))},regex:function(e){try{new RegExp(e)}catch(n){return!1}return!0},color:/^(?:(?:#?[0-9a-fA-F]{3,6})|(?:rgb\(\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(?:rgb\(\s*(?:\d?\d%|100%)\s*,\s*(?:\d?\d%|100%)\s*,\s*(?:\d?\d%|100%)\s*\))|(?:maroon|red|orange|yellow|olive|green|purple|fuchsia|lime|teal|aqua|blue|navy|black|gray|silver|white|indianred|lightcoral|salmon|darksalmon|lightsalmon|crimson|firebrick|darkred|pink|lightpink|hotpink|deeppink|mediumvioletred|palevioletred|lightsalmon|coral|tomato|orangered|darkorange|gold|lightyellow|lemonchiffon|lightgoldenrodyellow|papayawhip|moccasin|peachpuff|palegoldenrod|khaki|darkkhaki|lavender|thistle|plum|violet|orchid|magenta|mediumorchid|mediumpurple|amethyst|blueviolet|darkviolet|darkorchid|darkmagenta|indigo|slateblue|darkslateblue|mediumslateblue|greenyellow|chartreuse|lawngreen|limegreen|palegreen|lightgreen|mediumspringgreen|springgreen|mediumseagreen|seagreen|forestgreen|darkgreen|yellowgreen|olivedrab|darkolivegreen|mediumaquamarine|darkseagreen|lightseagreen|darkcyan|cyan|lightcyan|paleturquoise|aquamarine|turquoise|mediumturquoise|darkturquoise|cadetblue|steelblue|lightsteelblue|powderblue|lightblue|skyblue|lightskyblue|deepskyblue|dodgerblue|cornflowerblue|mediumslateblue|royalblue|mediumblue|darkblue|midnightblue|cornsilk|blanchedalmond|bisque|navajowhite|wheat|burlywood|tan|rosybrown|sandybrown|goldenrod|darkgoldenrod|peru|chocolate|saddlebrown|sienna|brown|snow|honeydew|mintcream|azure|aliceblue|ghostwhite|whitesmoke|seashell|beige|oldlace|floralwhite|ivory|antiquewhite|linen|lavenderblush|mistyrose|gainsboro|lightgrey|darkgray|dimgray|lightslategray|slategray|darkslategray))$/i,style:/^\s*[^:]+\s*:\s*[^:;]+\s*;{0,1}\s*$/,uri:/^(?:(?:[a-z0-9+.\-]+:\/\/)(?:(?:(?:[a-z0-9-._~!$&'()*+,;=:]|%[0-9A-F]{2})*)@)?(?:(?:[a-z0-9-._~!$&'()*+,;=]|%[0-9A-F]{2})*)(?::(?:\d*))?(?:\/(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?|(?:[a-z0-9+.\-]+:)(?:\/?(?:[a-z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})+(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?)(?:\?(?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*)?(?:#(?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*)?$/i,email:/^(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){255,})(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){65,}@)(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22))(?:\.(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22)))*@(?:(?:(?!.*[^.]{64,})(?:(?:(?:xn--)?[a-z0-9]+(?:-[a-z0-9]+)*\.){1,126}){1,}(?:(?:[a-z][a-z0-9]*)|(?:(?:xn--)[a-z0-9]+))(?:-[a-z0-9]+)*)|(?:\[(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){7})|(?:(?!(?:.*[a-f0-9][:\]]){7,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?)))|(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){5}:)|(?:(?!(?:.*[a-f0-9]:){5,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3}:)?)))?(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))(?:\.(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))){3}))\]))$/i,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,"host-name":/^(?:(?:[a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$/};_.each(e,function(e,n){"function"==typeof e?tv4.addFormat(n,function(t){return null===t||void 0===t||0===t.length?null:e(t)?null:"must be valid format: "+n}):tv4.addFormat(n,function(t){return null===t||void 0===t||0===t.length?null:e.test(t)?null:"must be valid "+n})});var n=function(e){"object"==typeof e&&_.each(e,function(t,r){""===t||void 0===t||null===t?delete e[r]:"object"==typeof t&&n(e[r])})};return{validate:function(e,t,r){n(e);var o=tv4.validateMultiple(e,t);if(o.valid)return null;if(_.each(o.errors,function(e){var n="/";e.dataPath&&(n=e.dataPath),e.params.key&&(n=e.dataPath+"/"+e.params.key),n=n.split("/"),n.shift(),e.path=n.join(".")}),r){for(var a=0;a<o.errors.length;a++){var i=o.errors[a];if(i.path===r)return[i]}return null}return o.errors}}}),angular.module("ngManager").controller("TopCtrl",["$rootScope",function(e){e.$emit("content.title",{section:"Top"})}]);
//# sourceMappingURL=maps/main.js.map