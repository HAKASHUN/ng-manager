"use strict";angular.module("ngManager",["ngRoute","ngAnimate","ngAria","ngMaterial","pascalprecht.translate"]).config(["$routeProvider",function(e){console.info("Configuring routings"),e.when("/endpoints",{controller:"EndpointCtrl",templateUrl:"endpoint.html"}).when("/top",{controller:"TopCtrl",templateUrl:"top.html"}).when("/entity/:kind",{controller:"EntityCtrl",templateUrl:"entity/index.html"})}]).run(["$endpointService","$apiService","$errorService","$location",function(e,n,t,r){console.info("Started running ng-manager");var o=e.getSelected();o?n.setup().then(function(){},function(e){t.showError(e)}):r.url("/endpoints")}]),angular.module("ngManager").factory("$apiService",["$q","$endpointService","$http","$rootScope",function(e,n,t,r){var o=null,i=function(e){var t=n.getSelected(),r=t.url.replace(/(.*)\/+$/,"$1");return e=e.replace(/^\/+(.*)$/,"$1"),r+"/"+e},a=function(n,r){return e(function(e,o){t({url:i(n),method:"GET",params:r}).then(function(n){e(n.data)},function(e){var n=e.data&&e.data.message||e.statusText,t=new Error(n);t.status=status,o(t)})})},l=function(n,r){return e(function(e,o){t({url:i(n),method:"PUT",data:r}).then(function(n){e(n.data)},function(e){var n=e&&e.statusText,t=new Error(n);t.status=status,o(t)})})},u=function(){return e(function(e,n){null!==o?e(o):(console.info("Getting config"),a("/config").then(e,n))})};return{setup:function(){return console.log("apiService.setup"),o=null,u().then(function(e){return o=e,r.$emit("config",o),o},function(e){return e})},config:function(){return o},get:a,put:l}}]).factory("progressHttpInterceptor",["$rootScope","$q",function(e,n){var t=0,r=function(){0===t++&&e.$emit("progress.start")},o=function(){0===--t&&(t=0,e.$emit("progress.end"))};return{request:function(e){return r(),e||n.when(e)},requestError:function(e){return o(),n.reject(e)},response:function(e){return o(),e||n.when(e)},responseError:function(e){return o(),n.reject(e)}}}]).config(["$httpProvider",function(e){e.interceptors.push("progressHttpInterceptor")}]),angular.module("ngManager").controller("EndpointCtrl",["$q","$scope","$rootScope","$schemaForm","$endpointService","$apiService","$errorService",function(e,n,t,r,o,i,a){n.endpoints=o.getAll(),n.remove=function(e){o.remove(e)},n.select=function(e){o.select(e),i.setup().then(function(){location.hash="top"},function(e){a.showError(e)})};var l=function(e){o.add(e)};t.$emit("content.title",{section:"Settings",page:"Endpoints"}),n.showForm=function(n){r.showDialog({title:"Add the endpoint",event:n,schema:{type:"object",properties:{name:{type:"string"},url:{type:"string",format:"uri",style:"long"}},required:["name","url"]},submit:function(n){var t=e.defer(),r=n.entity;return l(r),t.resolve(),t.promise}})}}]),angular.module("ngManager").factory("$endpointService",function(){var e=[],n=localStorage.getItem("endpoints");return n&&(e=JSON.parse(n)),{getAll:function(){return e},getSelected:function(){return _.find(e,function(e){return e.selected===!0})},get:function(n){return e[n]},add:function(n){e.push(n),this.save()},remove:function(n){e.splice(n,1),this.save()},select:function(n){_.each(e,function(e,t){t===n?e.selected=!0:delete e.selected}),this.save()},save:function(){var n=_.map(e,function(e){return _.pick(e,"name","url","selected")});localStorage.setItem("endpoints",JSON.stringify(n))}}}),angular.module("ngManager").controller("EntityCtrl",["$scope","$routeParams","$rootScope","$schemaForm","$entityService","$errorService","$window",function(e,n,t,r,o,i,a){var l=n.kind;console.info("Entity",l),t.$emit("content.title",{section:"Entities",page:l}),e.kind=l,e.list=function(){o.list({kind:l}).then(function(n){var t=o.getConfig(l),r=t.schema,i=t.keys||t.key;i||(i=_.keys(r.properties).shift()),"string"==typeof i&&(i=[i]),e.fields=n.fields,e.keys=i,e.rows=n.list,e.edit=function(e,n){e.editing=n},e.blur=function(e){delete e.editing},setTimeout(u,0)},function(e){i.showError(e)})};var u=function(){var e=document.getElementById("entity-table-body"),n=e.getBoundingClientRect(),t=Math.floor(a.innerHeight-n.top);e.style.height=t+"px"};e.$on("window.resize",u),e.list()}]),angular.module("ngManager").directive("entityTable",function(){return{restrict:"AE",link:function(e,n){var t=n.children().eq(1);t.on("scroll",function(e){{var n=e.target;n.scrollTop}})},templateUrl:"entity/table.html"}}).directive("entityRow",["$entityService","$errorService",function(e,n){return{restrict:"AE",scope:{row:"=",fields:"=",kind:"="},replace:!0,link:function(t){var r=t.kind,o=t.row;t.edit=function(){e.get({kind:r,key:o.key}).then(function(n){e.showForm({kind:r,entity:n})},function(e){n.showError(e)})},t.remove=function(){e.remove({kind:r,key:key}).then(function(){},function(e){n.showError(e)})}},templateUrl:"entity/row.html"}}]).directive("entityCell",["$entityService",function(e){return{restrict:"AE",scope:{field:"=",row:"=",kind:"="},replace:!0,link:function(n,t){var r=(n.kind,n.row),o=n.field;n.edit=function(){n.editing=!0,setTimeout(function(){var i=t.find("input");i.focus();var a=r.data[o.id];i.bind("keyup",function(t){switch(t.keyCode){case 27:r.data[o.id]=a,n.$digest(),i.blur();break;case 13:i.blur(),n.saving=!0,n.error=!1,e.saveField({kind:n.kind,key:r.key,field:o.id,value:r.data[o.id]}).then(function(){n.saving=!1},function(e){n.saving=!1,n.error=e}),n.$digest()}}),i.bind("blur",function(){a!==r.data[o.id]&&console.log("SAVING NEW FIELD",r.data[o.id])})},0)},n.blur=function(){n.editing=!1}},templateUrl:"entity/cell.html"}}]),angular.module("ngManager").service("$entityService",["$q","$apiService","$schemaForm",function(e,n,t){var r=function(e){return _.find(n.config().entities,function(n){return n.id===e})},o=function(e){var n=e.features||{},t=n.list&&n.list.fields||_.keys(e.schema.properties);return _.map(t,function(e){return"string"==typeof e&&(e={id:e}),e})};return{getConfig:r,list:function(t){t=t||{};var i=e.defer(),a=t.kind||"";return""===a?(i.reject(new Error("Kind is empty")),i.promise):(n.get("/entity/"+a,{limit:30}).then(function(e){var n=r(a);void 0===n?i.reject({message:"Entity configuration not found for {{kind}}",params:{kind:a}}):(e.fields=o(n),i.resolve(e))},function(e){i.reject(e)}),i.promise)},get:function(t){return t=t||{},e(function(e,o){var i=t.kind||"";if(""===i)return o(new Error("kind is empty"));var a=t.key;return void 0===a?o(new Error("key is null")):void n.get("/entity/"+i+"/"+a).then(function(n){var t=r(i);void 0===t?o({message:"Entity configuration not found for {{kind}}",params:{kind:i}}):e(n)},o)})},showForm:function(n){var o=e.defer(),i=r(n.kind);return t.showSide({schema:i.schema,entity:n.entity}),o.promise},saveField:function(e){var t=e.kind,r=e.key,o=e.field;return n.put("/entity/"+t+"/"+r+"/"+o)},remove:function(){var n=e.defer();return n.promise}}}]),angular.module("ngManager").factory("$errorService",["$mdToast",function(e){return{showError:function(n){var t="";t="string"==typeof n?n:n.message?n.message:n?n.toString():"Unknown Error",e.show({controller:["$scope",function(r){r.message=t,r.params=n.params||{},r.closeToast=function(){e.hide()}}],templateUrl:"toasts/error.html",duration:6e3,position:"top right"})}}}]),angular.module("ngManager").config(["$translateLoaderProvider",function(e){console.info("i18n: en"),e.translations("en",{name:"Name",url:"URL"})}]),angular.module("ngManager").config(["$translateLoaderProvider",function(e){console.info("i18n: ja"),e.translations("ja",{Add:"追加",Cancel:"キャンセル",Close:"閉じる",Create:"作成",Endpoints:"エンドポイント",Entities:"データ",Name:"名前",Update:"更新",Modify:"編集",Remove:"削除",Search:"検索",Settings:"設定",Submit:"送信",Top:"トップ",name:"名前",url:"URL","Add the endpoint":"エンドポイント追加","Entity configuration not found for {{kind}}":"{{kind}}のデータ設定が見つかりません"})}]),angular.module("ngManager").provider("$translateLoader",function(){var e={},n=function(n,t){var r=e[t];r||(r=e[t]={}),e[t]=_.merge(n,r)};this.translations=function(e,t){n(t,e)},this.$get=["$q",function(t){var r=function(n){var r=n.key,o=t.defer();return o.resolve(e[r]||{}),o.promise};return r.addTables=function(e){_.each(e,n)},r}]}).config(["$translateProvider",function(e){e.useLoader("$translateLoader"),e.determinePreferredLanguage()}]),angular.module("ngManager").controller("IndexCtrl",["$scope","$rootScope","$mdSidenav","$timeout","$interval","$location","$window","$translate","$translateLoader",function(e,n,t,r,o,i,a,l,u){e.toggleMenu=function(){r(function(){t("left").toggle()})},e.site={title:"NG-Manager"},e.head={title:""},n.$on("content.title",function(n,t){e.head.title=t}),n.$on("$locationChangeSuccess",function(){e.hash=location.hash}),n.$on("progress.start",function(){e.progress={mode:"query",value:0}}),n.$on("progress.end",function(){var n=e.progress;if("query"===n.mode)r(function(){e.progress=!1},500);else if("determinate"===n.mode)var t=o(function(){n.value+=20,n.value>=100&&(o.cancel(t),r(function(){delete e.progress},400))},50)}),e.openRight=!0,n.$on("config",function(n,t){console.info("Loaded configuration",t),e.config=t,e.site=t.site,t.i18n&&(u.addTables(t.i18n),l.refresh())}),a.addEventListener("resize",function(){n.$broadcast("window.resize")})}]),angular.module("ngManager").factory("$schemaForm",["$mdDialog","$sideContent","$schemaNormalizer","$schemaValidator","$q",function(e,n,t,r,o){var i=function(e){return function(n){var t=r.validate(e.entity,e.schema);t?(t.forEach(function(n){e.errors[n.path]=n.message}),e.hasError=!0):(n?delete e.errors[n]:e.errors={},e.hasError=!1)}},a=function(e,n,t,r){return function(){e.validate(),e.hasError||(t||(n.hide(),r.reject()),t(e).then(function(){n.hide(),r.resolve(e.entity)},function(e){r.reject(e)}))}},l=function(e,n,t){return function(){n.hide(),t.reject()}};return{showDialog:function(n){n=n||{};var r=n.schema,u=n.entity||{},c=n.event,s=o.defer(),d=n.submit,f=n.theme||"indigo";return r=t(r),e.show({template:'<md-dialog md-theme="'+f+'"><schema-form /></md-dialog>',targetEvent:c,controller:["$scope",function(t){t.schema=r,t.entity=u,t.title=n.title||"",t.errors={},t.validate=i(t),t.submit=a(t,e,d,s),t.cancel=l(t,e,s)}]}),s},showSide:function(e){var r=e.schema,u=e.entity||{},c=o.defer(),s=e.submit,d=e.theme||"teal";return r=t(r),n.show({template:'<md-content md-theme="'+d+'"><schema-form /></md-content>',targetEvent:event,controller:["$scope",function(e){e.schema=r,e.entity=u,e.errors={},e.validate=i(e),e.submit=a(e,n,s,c),e.cancel=l(e,n,c)}]}),c}}}]).directive("schemaForm",function(){return{restrict:"AE",templateUrl:"schema-form/form.html"}}).directive("schemaItem",["$compile","$templateCache",function(e,n){var t=function(t,r){var o=t.schema,i=n.get("schema-form/input.html"),a=e(angular.element(i))(t);o.style&&a.addClass(o.style),r.append(a)};return{scope:{schema:"=",entity:"=",errors:"="},restrict:"AE",replace:!0,link:t}}]),angular.module("ngManager").factory("$schemaNormalizer",function(){var e=function(n,t,r){return n.$$normalized?n:("string"==typeof n&&(n={type:n}),n.path=t?t+"."+r:r,n.key=r,"object"===n.type&&(_.each(n.properties,function(r,o){n.properties[o]=e(r,t,o)}),n.keyOrder=_.keys(n.properties)),n.$$normalized=!0,n)};return e}),angular.module("ngManager").factory("$schemaValidator",function(){var e={"date-time":/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{1,3})?(?:Z|[+\-]\d{2}:\d{2})$/,date:/^\d{4}-\d{2}-\d{2}$/,time:/^\d{2}:\d{2}:\d{2}(?:\.\d{1,3})?$/,"utc-millisec":function(e){return!isNaN(parseInt(e,10))},regex:function(e){try{new RegExp(e)}catch(n){return!1}return!0},color:/^(?:(?:#?[0-9a-fA-F]{3,6})|(?:rgb\(\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(?:rgb\(\s*(?:\d?\d%|100%)\s*,\s*(?:\d?\d%|100%)\s*,\s*(?:\d?\d%|100%)\s*\))|(?:maroon|red|orange|yellow|olive|green|purple|fuchsia|lime|teal|aqua|blue|navy|black|gray|silver|white|indianred|lightcoral|salmon|darksalmon|lightsalmon|crimson|firebrick|darkred|pink|lightpink|hotpink|deeppink|mediumvioletred|palevioletred|lightsalmon|coral|tomato|orangered|darkorange|gold|lightyellow|lemonchiffon|lightgoldenrodyellow|papayawhip|moccasin|peachpuff|palegoldenrod|khaki|darkkhaki|lavender|thistle|plum|violet|orchid|magenta|mediumorchid|mediumpurple|amethyst|blueviolet|darkviolet|darkorchid|darkmagenta|indigo|slateblue|darkslateblue|mediumslateblue|greenyellow|chartreuse|lawngreen|limegreen|palegreen|lightgreen|mediumspringgreen|springgreen|mediumseagreen|seagreen|forestgreen|darkgreen|yellowgreen|olivedrab|darkolivegreen|mediumaquamarine|darkseagreen|lightseagreen|darkcyan|cyan|lightcyan|paleturquoise|aquamarine|turquoise|mediumturquoise|darkturquoise|cadetblue|steelblue|lightsteelblue|powderblue|lightblue|skyblue|lightskyblue|deepskyblue|dodgerblue|cornflowerblue|mediumslateblue|royalblue|mediumblue|darkblue|midnightblue|cornsilk|blanchedalmond|bisque|navajowhite|wheat|burlywood|tan|rosybrown|sandybrown|goldenrod|darkgoldenrod|peru|chocolate|saddlebrown|sienna|brown|snow|honeydew|mintcream|azure|aliceblue|ghostwhite|whitesmoke|seashell|beige|oldlace|floralwhite|ivory|antiquewhite|linen|lavenderblush|mistyrose|gainsboro|lightgrey|darkgray|dimgray|lightslategray|slategray|darkslategray))$/i,style:/^\s*[^:]+\s*:\s*[^:;]+\s*;{0,1}\s*$/,uri:/^(?:(?:[a-z0-9+.\-]+:\/\/)(?:(?:(?:[a-z0-9-._~!$&'()*+,;=:]|%[0-9A-F]{2})*)@)?(?:(?:[a-z0-9-._~!$&'()*+,;=]|%[0-9A-F]{2})*)(?::(?:\d*))?(?:\/(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?|(?:[a-z0-9+.\-]+:)(?:\/?(?:[a-z0-9-._~!$&'()*+,;=:@]|%[0-9A-F]{2})+(?:[a-z0-9-._~!$&'()*+,;=:@\/]|%[0-9A-F]{2})*)?)(?:\?(?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*)?(?:#(?:[a-z0-9-._~!$&'()*+,;=:\/?@]|%[0-9A-F]{2})*)?$/i,email:/^(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){255,})(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){65,}@)(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22))(?:\.(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22)))*@(?:(?:(?!.*[^.]{64,})(?:(?:(?:xn--)?[a-z0-9]+(?:-[a-z0-9]+)*\.){1,126}){1,}(?:(?:[a-z][a-z0-9]*)|(?:(?:xn--)[a-z0-9]+))(?:-[a-z0-9]+)*)|(?:\[(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){7})|(?:(?!(?:.*[a-f0-9][:\]]){7,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?)))|(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){5}:)|(?:(?!(?:.*[a-f0-9]:){5,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3}:)?)))?(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))(?:\.(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))){3}))\]))$/i,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^((?=.*::)(?!.*::.+::)(::)?([\dA-F]{1,4}:(:|\b)|){5}|([\dA-F]{1,4}:){6})((([\dA-F]{1,4}((?!\3)::|:\b|$))|(?!\2\3)){2}|(((2[0-4]|1\d|[1-9])?\d|25[0-5])\.?\b){4})$/i,"host-name":/^(?:(?:[a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$/};_.each(e,function(e,n){"function"==typeof e?tv4.addFormat(n,function(t){return null===t||void 0===t||0===t.length?null:e(t)?null:"must be valid format: "+n}):tv4.addFormat(n,function(t){return null===t||void 0===t||0===t.length?null:e.test(t)?null:"must be valid "+n})});var n=function(e){"object"==typeof e&&_.each(e,function(t,r){""===t||void 0===t||null===t?delete e[r]:"object"==typeof t&&n(e[r])})};return{validate:function(e,t,r){n(e);var o=tv4.validateMultiple(e,t);if(o.valid)return null;if(_.each(o.errors,function(e){var n="/";e.dataPath&&(n=e.dataPath),e.params.key&&(n=e.dataPath+"/"+e.params.key),n=n.split("/"),n.shift(),e.path=n.join(".")}),r){for(var i=0;i<o.errors.length;i++){var a=o.errors[i];if(a.path===r)return[a]}return null}return o.errors}}}),angular.module("ngManager").service("$sideContent",["$rootElement","$$interimElement","$animate","$timeout","$window",function(e,n,t,r,o){var i,a=function(n,a,l){l.parent=angular.element(l.parent);var u=angular.element('<md-backdrop class="opaque ng-enter">');l.backdrop=u,l.onClickOutside=function(e){e.target===u[0]&&r(i.cancel)},l.onKeyupRoot=function(e){27===e.keyCode&&r(i.cancel)};var c=function(){var e=o.innerHeight;a.css("height",e+"px")};c(),e.bind("click",l.onClickOutside),e.bind("keyup",l.onKeyupRoot),n.$on("window.resize",c),t.enter(a,l.parent).then(function(){t.enter(u,l.parent,null)})},l=function(n,r,o){o.backdrop&&t.leave(o.backdrop),t.leave(r),o.escapeToClose&&e.off("keyup",o.onKeyupRoot),o.clickOutsideToClose&&e.off("click",o.onClickOutside)};return i=n({hasBackdrop:!0,isolateScope:!0,onShow:a,onRemove:l,clickOutsideToClose:!0,escapeToClose:!0,targetEvent:null,transformTemplate:function(e){return'<div class="side-content md-whiteframe-z2" layout="vertical" component="right">'+e+"</div>"}})}]),angular.module("ngManager").controller("TopCtrl",["$rootScope",function(e){e.$emit("content.title",{section:"Top"})}]);
//# sourceMappingURL=maps/main.js.map